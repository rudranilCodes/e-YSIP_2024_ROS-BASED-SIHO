# Laser To Odometry
This folder contains package which uses the laser data from scan topic to generate odometry. There are two package that works accurate enough to determine odometry which are available. The two are the rf2o_laser_odometry packaage and the other one is the ros2_laser_scan_matcher.

## rf2o_laser_odometry
RF2O is a fast and precise method to estimate the planar motion of a lidar using consecutive range scans. Instead of searching for correspondences, it performs dense scan alignment based on scan gradients, similar to dense 3D visual odometry. It formulates a range flow constraint equation for each scanned point, minimizes a robust function of geometric constraints, and solves this in a coarse-to-fine scheme to handle large displacements. A smooth filter based on the estimate's covariance is used to manage uncertainty in scenarios like corridors.

Details about the package [here](https://wiki.ros.org/rf2o_laser_odometry). This [Github repo](https://github.com/MAPIRlab/rf2o_laser_odometry) consists of the package for laser scan to odometry.

The package can be used to get odomerty via changing the parameter in the launch file rf2o_laser_odometry.launch.py file :
```python
parameters=[{
    # The node subscribes to the laser_scan_topic for the scan data.
    'laser_scan_topic' : 'scan',

    # The odom_topic give the odometry data which is generated by processing the scan data from laser_scan_topic.
    'odom_topic' : '/odom_rf2o',

    # Parameter whether to publish the tf, here it is False because we are already getting the tf of odom to base_link from gazebo.
    'publish_tf' : False,

    # This base_frame_id is the name of the robot base which is frame_id in laser scan topic.
    'base_frame_id' : 'base_link',

    # The odometry will be published which respect to the odom_frame_id.
    'odom_frame_id' : 'odom',

    # This is the odometry topic which is required to get the initial transform for base_link frame to the odom frame.
    'init_pose_from_topic' : '/odom',

    # Rate
    'freq' : 20.0
}]
```

Build the package and run the launch file to get the odometry. This command execute the CLaserOdometry2DNode.cpp file.
```sh
ros2 launch rf2o_laser_odometry rf2o_laser_odometry.launch.py
```

## ros2_laser_scan_matcher
The laser_scan_matcher package is a tool for incremental laser scan registration. It matches consecutive sensor_msgs/LaserScan messages and publishes the laser's estimated position as either geometry_msgs/Pose2D or a tf transform.

Although the package can function solely with scan data, providing an initial guess for the sensor's position with each new scan can speed up the registration process. When no guess is available, a common assumption is that the sensor remains stationary (zero-velocity model).
Details about the package [here](https://wiki.ros.org/laser_scan_matcher). This [Github repo](https://github.com/MAPIRlab/rf2o_laser_odometry) consists ported version of laser-scan-matcher to ros2 which was originally written in ros2 for laser scan to odometry.
This package does not take the initial pose so all the transform start from the origin.

This package requires a addition package named [csm](https://github.com/AlexKaravaev/csm) which is a dependency for this ros2_laser_scan_matcher.

The odometry data can be generated by setting up the parameters in the start_matcher.launch.py file :
```python
parameters=[{
        # This base_frame is the name of the robot base which is frame_id in laser scan topic.
        'base_frame': 'base_link',

        # The odometry will be published which respect to the odom_frame_id.
        'odom_frame': 'odom',

        # This is the frame id of the laser frame.
        'laser_frame': 'laser',

        # The generated odometry data will published on this publish_odom topic.
        'publish_odom': '/odom_matcher',
    }]
```

Build the package and run the launch file to get the odometry. This command execute the laser_scan_matcher.cpp file.
```sh
ros2 launch ros2_laser_scan_matcher start_matcher.launch.py
```

## scan_to_odom
This technique aligns new LIDAR scans with previous scans or a map to estimate motion accurately. Scan matching can be done using the Iterative Closest Point (ICP) algorithm. ICP works in three steps: association, transformation, and error evaluation. It matches points from the new scan to the previous scan, calculates the necessary rotation and translation for alignment, and measures the alignment error. These steps are repeated until the scans align satisfactorily, improving the robot's motion estimation by refining the alignment of successive LIDAR scans. More details in this [post](http://andrewjkramer.net/lidar-odometry-with-icp/). Also the GitHub repo can be found [here](https://github.com/1988kramer/intel_dataset).

This package can be used to visualise the the odometry generated from the scan topic.

Build the package and run the file to visualise the the odometry. This command execute the main.cpp file.
```sh
ros2 run scan_to_odom main.py
```